# TMflow Modbus 測試工具 - 新功能使用指南

## 🎯 快速上手

### 1. 📦 測試套件功能

測試套件讓你可以一次執行多個測試項目，不用一個一個點擊。

#### 使用步驟：

1. **選擇測試套件**
   ```
   在「測試套件」區域的下拉選單中選擇：
   - 基本功能測試（3 個測試）
   - 完整座標測試（3 個測試）
   - 狀態檢查（1 個測試）
   - User Define 測試（1 個測試）
   - 全功能測試（5 個測試）
   ```

2. **查看套件內容**
   ```
   點擊「查看內容」按鈕
   → 彈出視窗顯示包含哪些測試項目
   ```

3. **執行測試套件**
   ```
   點擊「執行套件」按鈕
   → 自動依序執行所有測試
   → 每個測試間隔 0.3 秒
   → 完成後顯示統計結果
   ```

#### 範例輸出：
```
🚀 開始執行測試套件: 完整座標測試
==================================================

▶️ 執行: Base 座標
📍 讀取 Base 座標 (位址 7001-7011)...
✅ Base 座標:
   X:  123.456 mm
   Y:  234.567 mm
   Z:  345.678 mm
   ...

▶️ 執行: Tool 座標
...

▶️ 執行: Joint 角度
...

==================================================
🎉 測試套件完成: 完整座標測試
📊 結果: 通過 3/3, 失敗 0/3
✅ 所有測試通過！
```

---

### 2. 🔖 IP 歷史記錄

不用每次都手動輸入 IP 位址，工具會自動記住你常用的 IP。

#### 使用步驟：

1. **首次連線**
   ```
   輸入 IP: 192.168.1.100
   點擊「連線」
   → 連線成功後自動記錄
   ```

2. **使用歷史記錄**
   ```
   點擊 IP 欄位的下拉箭頭 ▼
   → 顯示最近使用的 IP 列表
   → 點擊選擇
   → 點擊「連線」
   ```

3. **自動排序**
   ```
   最近使用的 IP 會自動排到最前面
   最多保存 10 個 IP
   ```

#### 設定檔位置：
```
testkit_config.json

內容範例：
{
  "ip_history": [
    "192.168.1.100",
    "192.168.1.101",
    "127.0.0.1"
  ],
  "last_ip": "192.168.1.100",
  "last_port": "502"
}
```

---

### 3. ⌨️ 鍵盤快捷鍵

提升操作效率，不用一直用滑鼠點擊。

#### 快捷鍵列表：

| 快捷鍵 | 功能 | 說明 |
|--------|------|------|
| **Ctrl+C** | 連線/斷線 | 快速切換連線狀態 |
| **Ctrl+T** | 執行全部測試 | 執行所有預設測試 |
| **F5** | 執行全部測試 | 同 Ctrl+T |
| **Ctrl+L** | 清除日誌 | 清空測試日誌 |
| **Ctrl+S** | 儲存日誌 | 儲存日誌到檔案 |
| **Esc** | 停止性能測試 | 中斷正在進行的性能測試 |

#### 使用範例：

```
情境 1：快速測試流程
1. 按 Ctrl+C → 連線
2. 按 F5 → 執行全部測試
3. 按 Ctrl+S → 儲存結果
4. 按 Ctrl+C → 斷線

情境 2：重複測試
1. 按 F5 → 執行測試
2. 按 Ctrl+L → 清除日誌
3. 按 F5 → 再次測試
4. 比對結果

情境 3：性能測試
1. 設定性能測試參數
2. 點擊「開始測試」
3. 如需中斷，按 Esc
```

---

### 4. 📊 CSV 匯出功能

將測試結果匯出為 Excel 可讀取的 CSV 格式，方便製作報告。

#### 使用步驟：

1. **執行測試**
   ```
   先執行一些測試
   → 產生測試日誌
   ```

2. **匯出 CSV**
   ```
   點擊「匯出 CSV」按鈕
   → 選擇儲存位置
   → 輸入檔名（預設：test_results_YYYYMMDD_HHMMSS.csv）
   → 點擊「儲存」
   ```

3. **開啟 CSV**
   ```
   使用 Excel 開啟
   → 自動識別 UTF-8 編碼
   → 顯示結構化資料
   ```

#### CSV 格式：

| 時間 | 測試項目 | 狀態 | 詳細資訊 |
|------|---------|------|---------|
| 14:30:15 | | 資訊 | 🚀 TM Robot 座標測試工具 v1.0.2.0003 已啟動 |
| 14:30:20 | | 成功 | 🔌 連線成功: 192.168.1.100:502 |
| 14:30:25 | | 資訊 | 📍 讀取 Base 座標 (位址 7001-7011)... |
| 14:30:26 | | 成功 | ✅ Base 座標: |
| 14:30:26 | | 資訊 |    X:  123.456 mm |

#### 用途：
- 製作測試報告
- 記錄測試歷史
- 比對不同時間的測試結果
- 提交給主管或客戶

---

### 5. 💡 改進的錯誤提示

當連線失敗時，工具會提供詳細的檢查清單和解決建議。

#### 錯誤訊息範例：

**舊版本：**
```
❌ 連線失敗
無法連線到 192.168.1.100:502
```

**新版本：**
```
❌ 連線失敗

無法連線到 192.168.1.100:502

請檢查：
1. TMflow 是否正在運行
2. Modbus TCP Server 是否已啟用
3. IP 位址和 Port 是否正確
4. 網路連線是否正常
```

#### 常見錯誤和解決方案：

| 錯誤訊息 | 可能原因 | 解決方案 |
|---------|---------|---------|
| 連線失敗 | TMflow 未啟動 | 啟動 TMflow 程式 |
| 連線失敗 | Modbus Server 未啟用 | 在 TMflow 中啟用 Modbus TCP Server |
| 連線逾時 | IP 位址錯誤 | 檢查 IP 位址是否正確 |
| 連線逾時 | 網路問題 | 檢查網路連線和防火牆設定 |
| 讀取失敗 | 位址不存在 | 確認位址範圍是否正確 |
| 寫入失敗 | 位址唯讀 | 確認該位址是否支援寫入 |

---

## 🎓 實用技巧

### 技巧 1：快速驗證連線
```
1. 按 Ctrl+C 連線
2. 點擊「Robot 狀態」測試
3. 如果能讀取到狀態，表示連線正常
```

### 技巧 2：批次測試流程
```
1. 選擇「全功能測試」套件
2. 點擊「執行套件」
3. 等待完成（約 2-3 秒）
4. 查看統計結果
5. 按 Ctrl+S 儲存日誌
```

### 技巧 3：性能基準測試
```
1. 選擇「極限測試」
2. 設定 1000 次，間隔 0ms
3. 開始測試
4. 記錄平均反應時間作為基準
5. 定期重複測試，比對性能變化
```

### 技巧 4：製作測試報告
```
1. 執行完整測試套件
2. 點擊「匯出 CSV」
3. 在 Excel 中開啟
4. 篩選「成功」和「失敗」
5. 製作圖表和統計
6. 加入結論和建議
```

### 技巧 5：自動化測試
```
1. 使用「連續監控」功能
2. 每 5 秒自動執行全部測試
3. 觀察長時間穩定性
4. 發現異常時按「停止監控」
5. 儲存日誌分析問題
```

---

## 🔧 進階設定

### 自定義測試套件

如果想要自己定義測試套件，可以修改程式碼：

```python
# 在 load_test_suites() 函數中新增
"我的測試套件": [
    {"name": "Base 座標", "func": "test_base_coords"},
    {"name": "Robot 狀態", "func": "test_robot_status"},
    # 新增更多測試...
]
```

### 調整測試間隔

測試套件預設間隔 0.3 秒，可以修改：

```python
# 在 run_test_suite() 函數中
time.sleep(0.3)  # 改成你想要的秒數
```

### 清除 IP 歷史

如果想清除 IP 歷史記錄：

```
方式 1：刪除設定檔
刪除 testkit_config.json

方式 2：手動編輯
開啟 testkit_config.json
修改 ip_history 陣列
```

---

## 📞 需要協助？

如有問題或建議：
1. 查看 [README.md](README.md) 完整說明
2. 查看 [更新說明_v1.0.2.md](更新說明_v1.0.2.md) 了解新功能
3. 查看 [Modbus測試項目建立指南.md](Modbus測試項目建立指南.md) 了解測試項目
4. 在 GitHub 提交 Issue

---

**版本**：v1.0.2.0003  
**更新日期**：2026-02-11
